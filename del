#!/bin/bash

# List of protected directories
PROTECTED=("/" "/etc" "/bin" "/boot" "/dev" "/lib" "/lib64" "/proc" "/root" "/sbin" "/sys" "/usr" "/var" "/home")

# Function to check if the target is a protected system dir
is_protected() {
  for dir in "${PROTECTED[@]}"; do
    if [[ "$1" == "$dir" || "$1" == "$dir/"* ]]; then
      return 0
    fi
  done
  return 1
}

# Check argument
if [ -z "$1" ]; then
  echo "Usage: del <directory_name>"
  exit 1
fi

TARGET="$1"

# Resolve absolute path
TARGET_ABS=$(realpath "$TARGET" 2>/dev/null)

# Validate directory exists
if [ ! -d "$TARGET_ABS" ]; then
  echo "Error: '$TARGET' is not a valid directory."
  exit 1
fi

# Check if protected
if is_protected "$TARGET_ABS"; then
  echo "⚠️  Refusing to delete protected system directory: '$TARGET_ABS'"
  exit 1
fi

# Confirm deletion
read -p "⚠️  Are you sure you want to permanently delete '$TARGET_ABS'? This cannot be undone. [y/N] " confirm
if [[ "$confirm" =~ ^[Yy]$ ]]; then
  rm -rf "$TARGET_ABS"
  echo "✅ Directory '$TARGET_ABS' deleted."
else
  echo "❌ Deletion cancelled."
fi
